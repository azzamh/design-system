import{H as S,O as D,z as j,aB as U,Y as Z,q as v,d as G,r as E,A as Q,o as M,c as ee,p as w,t as O,aC as T,al as _,a9 as q,m as ue,ad as ce,$ as de,a as fe,f as ve,g as he,a8 as pe,ah as me,a0 as z,a2 as R}from"./framework.etf_9QdW.js";import{a as te,c as ge,b as ye,o as be}from"./floating-ui.dom.Gn4DI--7.js";import{D as xe,P as ae,u as _e,a as we,f as Ne,b as Ie}from"./PdfViewer.vue_vue_type_style_index_0_lang.FfJFvCmG.js";import{c as $}from"./use-focus.oPJP1ZqW.js";import{m as Ee}from"./memoize.UOSzi-11.js";function Pe(o,e){const t=S(!0),n=S(),{hoverzone:a}=D(xe);async function r(){if(i(),o.value){const{default:s}=await Z(()=>import("./interact.min.BY9144DK.js").then(h=>h.i),__vite__mapDeps([0,1,2]));n.value=s(o.value).draggable({inertia:!0,enabled:t.value,autoScroll:{container:o.value.parentElement,margin:100,speed:300},onstart:e.onstart,onmove:e.onmove,onend:e.onend,modifiers:[s.modifiers.restrict({restriction:"parent",elementRect:{top:0,left:0,bottom:1,right:1}}),s.modifiers.restrictRect({endOnly:!0,restriction:()=>a.value?s.getElementRect(a.value):{top:0,left:0,bottom:Number.POSITIVE_INFINITY,right:Number.POSITIVE_INFINITY}})]}).on("tap",e.ontap)}}function i(){n.value&&n.value.unset()}return j(o,async()=>{await r()}),j(t,s=>{n.value&&n.value.draggable(s)}),U(()=>{i()}),t}function Oe(o,e={}){const t=S(!0),n=S();async function a(){var i,s,h;if(r(),o.value){const{default:p}=await Z(()=>import("./interact.min.BY9144DK.js").then(g=>g.i),__vite__mapDeps([0,1,2]));n.value=p(o.value).resizable({enabled:t.value,edges:{left:!1,top:!1,bottom:(i=e.handleSelector)!=null?i:".resize-handle",right:(s=e.handleSelector)!=null?s:".resize-handle"},onstart:e.onstart,onmove:e.onmove,onend:e.onend,modifiers:[p.modifiers.aspectRatio({ratio:(h=v(e.ratio))!=null?h:"preserve",modifiers:[p.modifiers.restrictSize({min:(g,P,c)=>{var f;const u=(f=v(e.scale))!=null?f:1;return{...c.rect,width:v(e.minWidth)*u,height:v(e.minHeight)*u}},max:(g,P,c)=>{var f;const u=(f=v(e.scale))!=null?f:1;return{...c.rect,width:v(e.maxWidth)*u,height:v(e.maxHeight)*u}}}),p.modifiers.restrictSize({max:(g,P,c)=>{const u=v(e.reference);if(u){const f=p.getElementRect(u);if(f){const y=f.right-c.rect.left,b=f.bottom-c.rect.top;return{...f,width:y,height:b}}}return{...c.rect,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY}}})]})]})}}function r(){n.value&&n.value.unset()}return j(o,async()=>{await a()}),j(t,i=>{n.value&&n.value.draggable(i)},{immediate:!0}),U(()=>{r()}),t}function Te(o,e=document.body){let t=o.parentElement;do{const{position:n}=window.getComputedStyle(t);if(n==="relative"||n==="absolute")return t;t=t.parentElement}while(t&&t!==e);return e}function Be(o){const{container:e,reference:t,x:n,y:a,scale:r}=o,i=t.getBoundingClientRect(),s=Te(t,e),h=s.getBoundingClientRect(),p=i.top-h.top+s.scrollTop,g=i.left-h.left+s.scrollLeft;return{top:p+a*r,left:g+n*r}}function ze(o){const{reference:e,object:t,scale:n}=o,a=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i=Math.floor((r.width-a.width)/n),s=Math.floor((r.height-a.height)/n),h=(a.left-r.left)/n,p=(a.top-r.top)/n,g=Number.parseInt(e.dataset.pageNumber);return{x:$(h,1,i-1),y:$(p,1,s-1),page:g}}function Re(o,e){return{x:(e.width-o.width)/2,y:(e.height-o.height)/2}}function Se(o,e){return o.x+o.width>e.width||o.y+o.height>e.height}function je(o){var n;const e=new Map,t=Ee(a=>Math.round(a/15)*15);for(const a of o){const r=t(a.x),i=t(a.y),s=(n=e.get(r))!=null?n:new Map;s.set(i,a),e.set(r,s)}return a=>{var s;const r=t(a.x),i=t(a.y);return((s=e.get(r))==null?void 0:s.get(i))!==void 0}}function $e(o){var s;const e=(s=o.checkOverlap)!=null?s:je(o.objects),t=Re(o.size,o.offside),n={...o.size,...t};let a=!0,r=0,i=0;do a=!0,Se(n,o.offside)&&(n.y=t.y+i,n.x=t.x,i+=15,a=!1),e(n,o.objects)&&(n.x+=15,n.y+=15,a=!1);while(!a&&++r<=500);return a||console.warn("Cannot find empty position, max iteration reach"),n}const Ce={"data-testid":"debug-x"},Me={"data-testid":"debug-y"},De={"data-testid":"debug-page"},Fe={"data-testid":"debug-width"},He={"data-testid":"debug-height"},Ye=G({__name:"PdfObjectDebugger",setup(o){const{x:e,y:t,page:n,width:a,height:r}=D(ae),i=E();return Q(s=>{if(i.value){const h=te(i.value.parentElement,i.value,()=>{ge(i.value.parentElement,i.value,{strategy:"absolute",middleware:[ye(),be(12)]}).then(({x:p,y:g})=>{i.value&&(i.value.style.left=`${p||0}px`,i.value.style.top=`${g||0}px`)})},{animationFrame:!0});s(h)}},{flush:"post"}),(s,h)=>(M(),ee("div",{ref_key:"target",ref:i,"data-testid":"pdf-debugger",class:"pdf-object__debugger"},[w("pre",Ce,"x: "+O(v(e)),1),w("pre",Me,"y: "+O(v(t)),1),w("pre",De,"page: "+O(v(n)),1),w("pre",Fe,"width: "+O(v(a)),1),w("pre",He,"height: "+O(v(r)),1)],512))}}),We=["data-x","data-y","data-page","data-width","data-height"],Ve={class:"pdf-object__container"},Ke={class:"pdf-object__resize resize-handle"},qe=G({__name:"PdfObject",props:{x:{type:Number,default:void 0},y:{type:Number,default:void 0},page:{type:Number,default:void 0},width:{type:Number,default:198},height:{type:Number,default:106},minWidth:{type:Number,default:void 0},minHeight:{type:Number,default:void 0},maxWidth:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},moveable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!1},debug:{type:Boolean,default:!1}},emits:["update:x","update:y","update:page","update:width","update:height"],setup(o){const e=o,t=E(),{root:n,scale:a,objects:r}=D(Ie),i=T(e,"x"),s=T(e,"y"),h=T(e,"page"),p=T(e,"width"),g=T(e,"height"),{id:P,x:c,y:u,page:f,width:y,height:b,minHeight:F,minWidth:H,maxHeight:Y,maxWidth:W,ratio:V}=_e(e),C=E(!1),K=E(),X=E(),k=E(),x=we(f),ne=Pe(t,{onstart(){const{left:l,top:d}=t.value.getBoundingClientRect();C.value=!0,K.value=c.value,X.value=u.value,k.value=f.value,c.value=l,u.value=d},onmove(l){c.value+=l.dx,u.value+=l.dy},onend(l){if(l.relatedTarget){const d=ze({reference:l.relatedTarget,container:n.value,object:t.value,scale:a.value});c.value=d.x,u.value=d.y,f.value=d.page}else c.value=K.value,u.value=X.value,f.value=k.value;C.value=!1}}),L=Oe(t,{minHeight:F,minWidth:H,maxHeight:Y,maxWidth:W,scale:a,ratio:V,reference:x,onmove(l){l.rect&&a.value&&(y.value=l.rect.width/a.value,b.value=l.rect.height/a.value)}});Q(l=>{if(t.value)if(x.value&&n.value)if(t.value.style.display="block",t.value.style.width=`${y.value}px`,t.value.style.height=`${b.value}px`,C.value)t.value.style.position="fixed",t.value.style.transform=`translate(${c.value}px, ${u.value}px) scale(${a.value})`,t.value.style.zIndex="50";else{const d=te(x.value,t.value,()=>{const{left:m,top:N}=Be({reference:x.value,container:n.value,x:c.value,y:u.value,scale:a.value});t.value.style.position="absolute",t.value.style.transform=`translate(${m}px, ${N}px) scale(${a.value})`,t.value.style.zIndex="10"},{ancestorScroll:!1,animationFrame:!0});l(d)}else t.value.style.display="none"});function B(l,d,m){if(e.moveable){const N=x.value.clientWidth,I=x.value.clientHeight,A=Math.floor(N/a.value-y.value),J=Math.floor(I/a.value-b.value),ie=l.metaKey||l.ctrlKey?A:l.shiftKey?10:1,se=l.metaKey||l.ctrlKey?J:l.shiftKey?10:1,le=c.value+d*ie,re=u.value+m*se;c.value=$(le,0,A),u.value=$(re,0,J)}}function oe(){const l=[...r.values()].filter(I=>I.id!==P&&Number.isFinite(I.x)&&Number.isFinite(I.y)&&I.page===f.value),d={width:y.value,height:b.value},m={width:x.value.clientWidth/a.value,height:x.value.clientHeight/a.value},N=$e({size:d,offside:m,objects:l});c.value=N.x,u.value=N.y}return _(c,i),_(u,s),_(f,h),_(y,p),_(b,g),_(ne,q(e,"moveable"),{direction:"rtl",immediate:!0}),_(L,q(e,"resizable"),{direction:"rtl",immediate:!0}),ue(async()=>{await ce(x).toBeTruthy(),(!Number.isFinite(c.value)||!Number.isFinite(u.value))&&oe(),e.autofocus&&Ne(t.value)}),de(ae,{id:P,x:c,y:u,page:f,width:y,height:b,minHeight:F,minWidth:H,maxHeight:Y,maxWidth:W,ratio:V}),(l,d)=>(M(),ee("div",{ref_key:"object",ref:t,"data-testid":"pdf-object",class:"pdf-object",tabindex:"0","data-x":v(c),"data-y":v(u),"data-page":v(f),"data-width":v(y),"data-height":v(b),onKeydown:[d[0]||(d[0]=z(R(m=>B(m,0,-1),["stop","prevent"]),["up"])),d[1]||(d[1]=z(R(m=>B(m,0,1),["stop","prevent"]),["down"])),d[2]||(d[2]=z(R(m=>B(m,-1,0),["stop","prevent"]),["left"])),d[3]||(d[3]=z(R(m=>B(m,1,0),["stop","prevent"]),["right"]))]},[w("div",Ve,[fe(l.$slots,"default"),o.debug?(M(),ve(Ye,{key:0})):he("",!0)]),pe(w("div",Ke,null,512),[[me,v(L)]])],40,We))}});export{qe as _,ze as g};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/chunks/interact.min.BY9144DK.js","assets/chunks/theme.kz-EmXzd.js","assets/chunks/framework.etf_9QdW.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}

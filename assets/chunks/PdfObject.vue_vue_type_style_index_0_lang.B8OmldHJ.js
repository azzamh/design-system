const __vite__fileDeps=["assets/chunks/interact.min.BcNng0lq.js","assets/chunks/commonjsHelpers.BosuxZz1.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{I as z,P as J,z as O,aG as q,$ as G,q as f,d as oe,r as E,aH as T,A as ie,as as w,t as L,m as ne,ag as le,a1 as se,o as k,c as re,p as A,a as ue,g as ce,h as de,ac as ve,ak as fe,a2 as B,a4 as R}from"./framework.CUNsVCb6.js";import{a as me}from"./floating-ui.dom.Bv9LQ7l_.js";import{D as he}from"./PdfViewer.vue_vue_type_style_index_0_lang.D80EUAVM.js";import{u as pe,a as ge,f as ye,P as be,b as xe}from"./use-idle.BxoOGwKb.js";import{c as j}from"./use-focus.BMEofKAE.js";import{g as we,_ as Ne}from"./PdfObjectDebugger.vue_vue_type_style_index_0_lang.Cmr7IHpL.js";function _e(u,t){const e=z(!0),a=z(),{hoverzone:o}=J(he);async function d(){if(v(),u.value){const{default:c}=await G(()=>import("./interact.min.BcNng0lq.js").then(h=>h.i),__vite__mapDeps([0,1]));a.value=c(u.value).draggable({inertia:!0,enabled:e.value,autoScroll:{container:u.value.parentElement,margin:100,speed:300},onstart:t.onstart,onmove:t.onmove,onend:t.onend,modifiers:[c.modifiers.restrict({restriction:"parent",elementRect:{top:0,left:0,bottom:1,right:1}}),c.modifiers.restrictRect({endOnly:!0,restriction:()=>o.value?c.getElementRect(o.value):{top:0,left:0,bottom:Number.POSITIVE_INFINITY,right:Number.POSITIVE_INFINITY}})]}).on("tap",t.ontap)}}function v(){a.value&&a.value.unset()}return O(u,async()=>{await d()}),O(e,c=>{a.value&&a.value.draggable(c)}),q(()=>{v()}),e}function Ie(u,t={}){const e=z(!0),a=z();async function o(){var v,c,h;if(d(),u.value){const{default:p}=await G(()=>import("./interact.min.BcNng0lq.js").then(g=>g.i),__vite__mapDeps([0,1]));a.value=p(u.value).resizable({enabled:e.value,edges:{left:!1,top:!1,bottom:(v=t.handleSelector)!=null?v:".resize-handle",right:(c=t.handleSelector)!=null?c:".resize-handle"},onstart:t.onstart,onmove:t.onmove,onend:t.onend,modifiers:[p.modifiers.aspectRatio({ratio:(h=f(t.ratio))!=null?h:"preserve",modifiers:[p.modifiers.restrictSize({min:(g,I,l)=>{var r;const n=(r=f(t.scale))!=null?r:1;return{...l.rect,width:f(t.minWidth)*n,height:f(t.minHeight)*n}},max:(g,I,l)=>{var r;const n=(r=f(t.scale))!=null?r:1;return{...l.rect,width:f(t.maxWidth)*n,height:f(t.maxHeight)*n}}}),p.modifiers.restrictSize({max:(g,I,l)=>{const n=f(t.reference);if(n){const r=p.getElementRect(n);if(r){const y=r.right-l.rect.left,b=r.bottom-l.rect.top;return{...r,width:y,height:b}}}return{...l.rect,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY}}})]})]})}}function d(){a.value&&a.value.unset()}return O(u,async()=>{await o()}),O(e,v=>{a.value&&a.value.draggable(v)},{immediate:!0}),q(()=>{d()}),e}function Ee(u,t=document.body){let e=u.parentElement;do{const{position:a}=window.getComputedStyle(e);if(a==="relative"||a==="absolute")return e;e=e.parentElement}while(e&&e!==t);return t}function Te(u){const{container:t,reference:e,x:a,y:o,scale:d}=u,v=e.getBoundingClientRect(),c=Ee(e,t),h=c.getBoundingClientRect(),p=v.top-h.top+c.scrollTop,g=v.left-h.left+c.scrollLeft;return{top:p+o*d,left:g+a*d}}function Pe(u){const{reference:t,object:e,scale:a}=u,o=e.getBoundingClientRect(),d=t.getBoundingClientRect(),v=Math.floor((d.width-o.width)/a),c=Math.floor((d.height-o.height)/a),h=(o.left-d.left)/a,p=(o.top-d.top)/a,g=Number.parseInt(t.dataset.pageNumber);return{x:j(h,1,v-1),y:j(p,1,c-1),page:g}}const Be=["data-x","data-y","data-page","data-width","data-height"],Re={class:"pdf-object__container"},ze={class:"pdf-object__resize resize-handle"},We=oe({__name:"PdfObject",props:{x:{type:Number,default:void 0},y:{type:Number,default:void 0},page:{type:Number,default:void 0},width:{type:Number,default:198},height:{type:Number,default:106},minWidth:{type:Number,default:void 0},minHeight:{type:Number,default:void 0},maxWidth:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},moveable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!1},debug:{type:Boolean,default:!1}},emits:["update:x","update:y","update:page","update:width","update:height"],setup(u){const t=u,e=E(),{root:a,scale:o,objects:d}=J(be),v=T(t,"x"),c=T(t,"y"),h=T(t,"page"),p=T(t,"width"),g=T(t,"height"),{id:I,x:l,y:n,page:r,width:y,height:b,minHeight:C,minWidth:H,maxHeight:F,maxWidth:W,ratio:$}=pe(t),S=E(!1),D=E(),M=E(),Y=E(),x=ge(r),U=_e(e,{onstart(){const{left:i,top:s}=e.value.getBoundingClientRect();S.value=!0,D.value=l.value,M.value=n.value,Y.value=r.value,l.value=i,n.value=s},onmove(i){l.value+=i.dx,n.value+=i.dy},onend(i){if(i.relatedTarget){const s=Pe({reference:i.relatedTarget,container:a.value,object:e.value,scale:o.value});l.value=s.x,n.value=s.y,r.value=s.page}else l.value=D.value,n.value=M.value,r.value=Y.value;S.value=!1}}),V=Ie(e,{minHeight:C,minWidth:H,maxHeight:F,maxWidth:W,scale:o,ratio:$,reference:x,onmove(i){i.rect&&o.value&&(y.value=i.rect.width/o.value,b.value=i.rect.height/o.value)}});ie(i=>{if(e.value)if(x.value&&a.value)if(e.value.style.display="block",e.value.style.width=`${y.value}px`,e.value.style.height=`${b.value}px`,S.value)e.value.style.position="fixed",e.value.style.transform=`translate(${l.value}px, ${n.value}px) scale(${o.value})`,e.value.style.zIndex="50";else{const s=me(x.value,e.value,()=>{const{left:m,top:N}=Te({reference:x.value,container:a.value,x:l.value,y:n.value,scale:o.value});e.value.style.position="absolute",e.value.style.transform=`translate(${m}px, ${N}px) scale(${o.value})`,e.value.style.zIndex="10"},{ancestorScroll:!1,animationFrame:!0});i(s)}else e.value.style.display="none"});function P(i,s,m){if(t.moveable){const N=x.value.clientWidth,_=x.value.clientHeight,K=Math.floor(N/o.value-y.value),X=Math.floor(_/o.value-b.value),Q=i.metaKey||i.ctrlKey?K:i.shiftKey?10:1,ee=i.metaKey||i.ctrlKey?X:i.shiftKey?10:1,te=l.value+s*Q,ae=n.value+m*ee;l.value=j(te,0,K),n.value=j(ae,0,X)}}function Z(){const i=[...d.values()].filter(_=>_.id!==I&&Number.isFinite(_.x)&&Number.isFinite(_.y)&&_.page===r.value),s={width:y.value,height:b.value},m={width:x.value.clientWidth/o.value,height:x.value.clientHeight/o.value},N=we({size:s,offside:m,objects:i});l.value=N.x,n.value=N.y}return w(l,v),w(n,c),w(r,h),w(y,p),w(b,g),w(U,L(t,"moveable"),{direction:"rtl",immediate:!0}),w(V,L(t,"resizable"),{direction:"rtl",immediate:!0}),ne(async()=>{await le(x).toBeTruthy(),(!Number.isFinite(l.value)||!Number.isFinite(n.value))&&Z(),t.autofocus&&ye(e.value)}),se(xe,{id:I,x:l,y:n,page:r,width:y,height:b,minHeight:C,minWidth:H,maxHeight:F,maxWidth:W,ratio:$}),(i,s)=>(k(),re("div",{ref_key:"object",ref:e,"data-testid":"pdf-object",class:"pdf-object",tabindex:"0","data-x":f(l),"data-y":f(n),"data-page":f(r),"data-width":f(y),"data-height":f(b),onKeydown:[s[0]||(s[0]=B(R(m=>P(m,0,-1),["stop","prevent"]),["up"])),s[1]||(s[1]=B(R(m=>P(m,0,1),["stop","prevent"]),["down"])),s[2]||(s[2]=B(R(m=>P(m,-1,0),["stop","prevent"]),["left"])),s[3]||(s[3]=B(R(m=>P(m,1,0),["stop","prevent"]),["right"]))]},[A("div",Re,[ue(i.$slots,"default"),u.debug?(k(),ce(Ne,{key:0})):de("",!0)]),ve(A("div",ze,null,512),[[fe,f(V)]])],40,Be))}});export{We as _,Pe as g};

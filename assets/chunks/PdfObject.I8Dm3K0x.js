import{a as J,c as ce,b as fe,o as ve}from"./floating-ui.dom._N-HlnuN.js";import{t as q,u as E}from"./index.9VyAL9bU.js";import{H as B,O as M,z as R,al as U,Y as Z,q as b,d as G,A as Q,_ as ee,o as j,c as te,p as x,t as $,r as P,aa as k,m as he,$ as me,E as pe,a as ge,f as ye,g as be,a9 as we,ae as xe,a0 as T,a2 as z}from"./framework.df26sawU.js";import{D as _e,P as ae,a as Ne,u as Ie,b as Ee,f as A}from"./PdfViewer.GoN0gRUO.js";import{c as S}from"./use-focus.oPJP1ZqW.js";import{m as $e}from"./memoize.UOSzi-11.js";import{s as w,u as Oe}from"./index.0_XlVUlk.js";function Pe(t,e){const n=B(!0),a=B(),{hoverzone:i}=M(_e);async function s(){if(l(),t.value){const{default:o}=await Z(()=>import("./interact.min.a-H_9DSX.js").then(v=>v.i),__vite__mapDeps([0,1,2]));a.value=o(t.value).draggable({inertia:!0,enabled:n.value,autoScroll:{container:t.value.parentElement,margin:100,speed:300},onstart:e.onstart,onmove:e.onmove,onend:e.onend,modifiers:[o.modifiers.restrict({restriction:"parent",elementRect:{top:0,left:0,bottom:1,right:1}}),o.modifiers.restrictRect({endOnly:!0,restriction:()=>i.value?o.getElementRect(i.value):{top:0,left:0,bottom:Number.POSITIVE_INFINITY,right:Number.POSITIVE_INFINITY}})]}).on("tap",e.ontap)}}function l(){a.value&&a.value.unset()}return R(t,async()=>{await s()}),R(n,o=>{a.value&&a.value.draggable(o)}),U(()=>{l()}),n}function Te(t,e={}){const n=B(!0),a=B();async function i(){var l,o,v;if(s(),t.value){const{default:h}=await Z(()=>import("./interact.min.a-H_9DSX.js").then(m=>m.i),__vite__mapDeps([0,1,2]));a.value=h(t.value).resizable({enabled:n.value,edges:{left:!1,top:!1,bottom:(l=e.handleSelector)!=null?l:".resize-handle",right:(o=e.handleSelector)!=null?o:".resize-handle"},onstart:e.onstart,onmove:e.onmove,onend:e.onend,modifiers:[h.modifiers.aspectRatio({ratio:(v=b(e.ratio))!=null?v:"preserve",modifiers:[h.modifiers.restrictSize({min:(m,c,u)=>{var d;const f=(d=b(e.scale))!=null?d:1;return{...u.rect,width:b(e.minWidth)*f,height:b(e.minHeight)*f}},max:(m,c,u)=>{var d;const f=(d=b(e.scale))!=null?d:1;return{...u.rect,width:b(e.maxWidth)*f,height:b(e.maxHeight)*f}}}),h.modifiers.restrictSize({max:(m,c,u)=>{const f=b(e.reference);if(f){const d=h.getElementRect(f);if(d){const y=d.right-u.rect.left,O=d.bottom-u.rect.top;return{...d,width:y,height:O}}}return{...u.rect,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY}}})]})]})}}function s(){a.value&&a.value.unset()}return R(t,async()=>{await i()}),R(n,l=>{a.value&&a.value.draggable(l)},{immediate:!0}),U(()=>{s()}),n}function ze(t,e=document.body){let n=t.parentElement;do{const{position:a}=window.getComputedStyle(n);if(a==="relative"||a==="absolute")return n;n=n.parentElement}while(n&&n!==e);return e}function Be(t){const{container:e,reference:n,x:a,y:i,scale:s}=t,l=n.getBoundingClientRect(),o=ze(n,e),v=o.getBoundingClientRect(),h=l.top-v.top+o.scrollTop,m=l.left-v.left+o.scrollLeft;return{top:h+i*s,left:m+a*s}}function Re(t){const{reference:e,object:n,scale:a}=t,i=n.getBoundingClientRect(),s=e.getBoundingClientRect(),l=Math.floor((s.width-i.width)/a),o=Math.floor((s.height-i.height)/a),v=(i.left-s.left)/a,h=(i.top-s.top)/a,m=Number.parseInt(e.dataset.pageNumber);return{x:S(v,1,l-1),y:S(h,1,o-1),page:m}}function Se(t,e){return{x:(e.width-t.width)/2,y:(e.height-t.height)/2}}function Ce(t,e){return t.x+t.width>e.width||t.y+t.height>e.height}function je(t){var a;const e=new Map,n=$e(i=>Math.round(i/15)*15);for(const i of t){const s=n(i.x),l=n(i.y),o=(a=e.get(s))!=null?a:new Map;o.set(l,i),e.set(s,o)}return i=>{var o;const s=n(i.x),l=n(i.y);return((o=e.get(s))==null?void 0:o.get(l))!==void 0}}function Me(t){var o;const e=(o=t.checkOverlap)!=null?o:je(t.objects),n=Se(t.size,t.offside),a={...t.size,...n};let i=!0,s=0,l=0;do i=!0,Ce(a,t.offside)&&(a.y=n.y+l,a.x=n.x,l+=15,i=!1),e(a,t.objects)&&(a.x+=15,a.y+=15,i=!1);while(!i&&++s<=500);return i||console.warn("Cannot find empty position, max iteration reach"),a}const De=G({setup(){const{x:t,y:e,page:n,width:a,height:i}=M(ae),s=q("target");return Q(l=>{if(s.value){const o=J(s.value.parentElement,s.value,()=>{ce(s.value.parentElement,s.value,{strategy:"absolute",middleware:[fe(),ve(12)]}).then(({x:v,y:h})=>{s.value&&(s.value.style.left=`${v||0}px`,s.value.style.top=`${h||0}px`)})},{animationFrame:!0});l(o)}},{flush:"post"}),{x:t,y:e,page:n,width:a,height:i}}}),Fe={ref:"target","data-testid":"pdf-debugger",class:"pdf-object__debugger"},He={"data-testid":"debug-x"},Ye={"data-testid":"debug-y"},We={"data-testid":"debug-page"},Ve={"data-testid":"debug-width"},Ke={"data-testid":"debug-height"};function Xe(t,e,n,a,i,s){return j(),te("div",Fe,[x("pre",He,"x: "+$(t.x),1),x("pre",Ye,"y: "+$(t.y),1),x("pre",We,"page: "+$(t.page),1),x("pre",Ve,"width: "+$(t.width),1),x("pre",Ke,"height: "+$(t.height),1)],512)}const Le=ee(De,[["render",Xe]]),ke=G({components:{PdfObjectDebugger:Le},props:{x:{type:Number,default:void 0},y:{type:Number,default:void 0},page:{type:Number,default:void 0},width:{type:Number,default:198},height:{type:Number,default:106},minWidth:{type:Number,default:void 0},minHeight:{type:Number,default:void 0},maxWidth:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},moveable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!1},debug:{type:Boolean,default:!1}},emits:["update:x","update:y","update:page","update:width","update:height"],setup(t){const e=q("object"),{root:n,scale:a,objects:i}=M(Ne),s=E(t,"x"),l=E(t,"y"),o=E(t,"page"),v=E(t,"width"),h=E(t,"height"),{id:m,x:c,y:u,page:f,width:d,height:y,minHeight:O,minWidth:D,maxHeight:F,maxWidth:H,ratio:Y}=Ie(t),C=P(!1),W=P(),V=P(),K=P(),g=Ee(f),ne=Pe(e,{onstart(){const{left:r,top:p}=e.value.getBoundingClientRect();C.value=!0,W.value=c.value,V.value=u.value,K.value=f.value,c.value=r,u.value=p},onmove(r){c.value+=r.dx,u.value+=r.dy},onend(r){if(r.relatedTarget){const p=Re({reference:r.relatedTarget,container:n.value,object:e.value,scale:a.value});c.value=p.x,u.value=p.y,f.value=p.page}else c.value=W.value,u.value=V.value,f.value=K.value;C.value=!1}}),oe=Te(e,{minHeight:O,minWidth:D,maxHeight:F,maxWidth:H,scale:a,ratio:Y,reference:g,onmove(r){r.rect&&a.value&&(d.value=r.rect.width/a.value,y.value=r.rect.height/a.value)}});Q(r=>{if(e.value)if(g.value&&n.value)if(e.value.style.display="block",e.value.style.width=`${d.value}px`,e.value.style.height=`${y.value}px`,C.value)e.value.style.position="fixed",e.value.style.transform=`translate(${c.value}px, ${u.value}px) scale(${a.value})`,e.value.style.zIndex="50";else{const p=J(g.value,e.value,()=>{const{left:I,top:_}=Be({reference:g.value,container:n.value,x:c.value,y:u.value,scale:a.value});e.value.style.position="absolute",e.value.style.transform=`translate(${I}px, ${_}px) scale(${a.value})`,e.value.style.zIndex="10"},{ancestorScroll:!1,animationFrame:!0});r(p)}else e.value.style.display="none"});function ie(r,p,I){if(t.moveable){const _=g.value.clientWidth,N=g.value.clientHeight,X=Math.floor(_/a.value-d.value),L=Math.floor(N/a.value-y.value),le=r.metaKey||r.ctrlKey?X:r.shiftKey?10:1,re=r.metaKey||r.ctrlKey?L:r.shiftKey?10:1,ue=c.value+p*le,de=u.value+I*re;c.value=S(ue,0,X),u.value=S(de,0,L)}}function se(){const r=[...i.values()].filter(N=>N.id!==m&&Number.isFinite(N.x)&&Number.isFinite(N.y)&&N.page===f.value),p={width:d.value,height:y.value},I={width:g.value.clientWidth/a.value,height:g.value.clientHeight/a.value},_=Me({size:p,offside:I,objects:r});c.value=_.x,u.value=_.y}return w(c,s),w(u,l),w(f,o),w(d,v),w(y,h),w(ne,k(t,"moveable"),{direction:"rtl",immediate:!0}),w(oe,k(t,"resizable"),{direction:"rtl",immediate:!0}),he(async()=>{await Oe(g).toBeTruthy(),(!Number.isFinite(c.value)||!Number.isFinite(u.value))&&se(),t.autofocus&&A(e.value)}),me(ae,{id:m,x:c,y:u,page:f,width:d,height:y,minHeight:O,minWidth:D,maxHeight:F,maxWidth:H,ratio:Y}),{move:ie,focus:A}}}),Ae=["data-x","data-y","data-page","data-width","data-height"],Je={class:"pdf-object__container"},qe={class:"pdf-object__resize resize-handle"};function Ue(t,e,n,a,i,s){const l=pe("PdfObjectDebugger");return j(),te("div",{ref:"object","data-testid":"pdf-object",class:"pdf-object",tabindex:"0","data-x":t.x,"data-y":t.y,"data-page":t.page,"data-width":t.width,"data-height":t.height,onKeydown:[e[0]||(e[0]=T(z(o=>t.move(o,0,-1),["stop","prevent"]),["up"])),e[1]||(e[1]=T(z(o=>t.move(o,0,1),["stop","prevent"]),["down"])),e[2]||(e[2]=T(z(o=>t.move(o,-1,0),["stop","prevent"]),["left"])),e[3]||(e[3]=T(z(o=>t.move(o,1,0),["stop","prevent"]),["right"]))]},[x("div",Je,[ge(t.$slots,"default"),t.debug?(j(),ye(l,{key:0})):be("",!0)]),we(x("div",qe,null,512),[[xe,t.resizable]])],40,Ae)}const ot=ee(ke,[["render",Ue]]);export{Re as g,ot as p};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/chunks/interact.min.a-H_9DSX.js","assets/chunks/theme.TdAhZPKA.js","assets/chunks/framework.df26sawU.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
const __vite__fileDeps=["assets/chunks/interact.min.DvqBbOwP.js","assets/chunks/theme.DiBbYFF8.js","assets/chunks/framework.BSGfltUV.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{H as S,O as H,y as j,aG as G,Z as U,p as v,d as q,r as E,z as Q,o as C,c as ee,m as w,t as O,aH as T,ap as _,ac as Z,l as ue,ag as ce,a0 as de,a as fe,f as ve,g as he,ab as pe,ak as me,a1 as B,a3 as R}from"./framework.BSGfltUV.js";import{a as te,c as ge,b as ye,o as be}from"./floating-ui.dom.Bv9LQ7l_.js";import{D as xe,P as ae,u as _e,a as we,f as Ne,b as Ie}from"./PdfViewer.vue_vue_type_style_index_0_lang.IwdYEKqR.js";import{c as M}from"./use-focus.BMEofKAE.js";import{m as Ee}from"./memoize.CbuPQmPs.js";function Pe(o,e){const t=S(!0),n=S(),{hoverzone:a}=H(xe);async function r(){if(i(),o.value){const{default:s}=await U(()=>import("./interact.min.DvqBbOwP.js").then(h=>h.i),__vite__mapDeps([0,1,2]));n.value=s(o.value).draggable({inertia:!0,enabled:t.value,autoScroll:{container:o.value.parentElement,margin:100,speed:300},onstart:e.onstart,onmove:e.onmove,onend:e.onend,modifiers:[s.modifiers.restrict({restriction:"parent",elementRect:{top:0,left:0,bottom:1,right:1}}),s.modifiers.restrictRect({endOnly:!0,restriction:()=>a.value?s.getElementRect(a.value):{top:0,left:0,bottom:Number.POSITIVE_INFINITY,right:Number.POSITIVE_INFINITY}})]}).on("tap",e.ontap)}}function i(){n.value&&n.value.unset()}return j(o,async()=>{await r()}),j(t,s=>{n.value&&n.value.draggable(s)}),G(()=>{i()}),t}function Oe(o,e={}){const t=S(!0),n=S();async function a(){var i,s,h;if(r(),o.value){const{default:p}=await U(()=>import("./interact.min.DvqBbOwP.js").then(g=>g.i),__vite__mapDeps([0,1,2]));n.value=p(o.value).resizable({enabled:t.value,edges:{left:!1,top:!1,bottom:(i=e.handleSelector)!=null?i:".resize-handle",right:(s=e.handleSelector)!=null?s:".resize-handle"},onstart:e.onstart,onmove:e.onmove,onend:e.onend,modifiers:[p.modifiers.aspectRatio({ratio:(h=v(e.ratio))!=null?h:"preserve",modifiers:[p.modifiers.restrictSize({min:(g,P,c)=>{var f;const u=(f=v(e.scale))!=null?f:1;return{...c.rect,width:v(e.minWidth)*u,height:v(e.minHeight)*u}},max:(g,P,c)=>{var f;const u=(f=v(e.scale))!=null?f:1;return{...c.rect,width:v(e.maxWidth)*u,height:v(e.maxHeight)*u}}}),p.modifiers.restrictSize({max:(g,P,c)=>{const u=v(e.reference);if(u){const f=p.getElementRect(u);if(f){const y=f.right-c.rect.left,b=f.bottom-c.rect.top;return{...f,width:y,height:b}}}return{...c.rect,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY}}})]})]})}}function r(){n.value&&n.value.unset()}return j(o,async()=>{await a()}),j(t,i=>{n.value&&n.value.draggable(i)},{immediate:!0}),G(()=>{r()}),t}function Te(o,e=document.body){let t=o.parentElement;do{const{position:n}=window.getComputedStyle(t);if(n==="relative"||n==="absolute")return t;t=t.parentElement}while(t&&t!==e);return e}function ze(o){const{container:e,reference:t,x:n,y:a,scale:r}=o,i=t.getBoundingClientRect(),s=Te(t,e),h=s.getBoundingClientRect(),p=i.top-h.top+s.scrollTop,g=i.left-h.left+s.scrollLeft;return{top:p+a*r,left:g+n*r}}function Be(o){const{reference:e,object:t,scale:n}=o,a=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i=Math.floor((r.width-a.width)/n),s=Math.floor((r.height-a.height)/n),h=(a.left-r.left)/n,p=(a.top-r.top)/n,g=Number.parseInt(e.dataset.pageNumber);return{x:M(h,1,i-1),y:M(p,1,s-1),page:g}}function Re(o,e){return{x:(e.width-o.width)/2,y:(e.height-o.height)/2}}function Se(o,e){return o.x+o.width>e.width||o.y+o.height>e.height}function je(o){var n;const e=new Map,t=Ee(a=>Math.round(a/15)*15);for(const a of o){const r=t(a.x),i=t(a.y),s=(n=e.get(r))!=null?n:new Map;s.set(i,a),e.set(r,s)}return a=>{var s;const r=t(a.x),i=t(a.y);return((s=e.get(r))==null?void 0:s.get(i))!==void 0}}function Me(o){var s;const e=(s=o.checkOverlap)!=null?s:je(o.objects),t=Re(o.size,o.offside),n={...o.size,...t};let a=!0,r=0,i=0;do a=!0,Se(n,o.offside)&&(n.y=t.y+i,n.x=t.x,i+=15,a=!1),e(n,o.objects)&&(n.x+=15,n.y+=15,a=!1);while(!a&&++r<=500);return a||console.warn("Cannot find empty position, max iteration reach"),n}const $e={"data-testid":"debug-x"},Ce={"data-testid":"debug-y"},He={"data-testid":"debug-page"},De={"data-testid":"debug-width"},Fe={"data-testid":"debug-height"},We=q({__name:"PdfObjectDebugger",setup(o){const{x:e,y:t,page:n,width:a,height:r}=H(ae),i=E();return Q(s=>{if(i.value){const h=te(i.value.parentElement,i.value,()=>{ge(i.value.parentElement,i.value,{strategy:"absolute",middleware:[ye(),be(12)]}).then(({x:p,y:g})=>{i.value&&(i.value.style.left=`${p||0}px`,i.value.style.top=`${g||0}px`)})},{animationFrame:!0});s(h)}},{flush:"post"}),(s,h)=>(C(),ee("div",{ref_key:"target",ref:i,"data-testid":"pdf-debugger",class:"pdf-object__debugger"},[w("pre",$e,"x: "+O(v(e)),1),w("pre",Ce,"y: "+O(v(t)),1),w("pre",He,"page: "+O(v(n)),1),w("pre",De,"width: "+O(v(a)),1),w("pre",Fe,"height: "+O(v(r)),1)],512))}}),Ye=["data-x","data-y","data-page","data-width","data-height"],Ve={class:"pdf-object__container"},Ke={class:"pdf-object__resize resize-handle"},Ze=q({__name:"PdfObject",props:{x:{type:Number,default:void 0},y:{type:Number,default:void 0},page:{type:Number,default:void 0},width:{type:Number,default:198},height:{type:Number,default:106},minWidth:{type:Number,default:void 0},minHeight:{type:Number,default:void 0},maxWidth:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},moveable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!1},debug:{type:Boolean,default:!1}},emits:["update:x","update:y","update:page","update:width","update:height"],setup(o){const e=o,t=E(),{root:n,scale:a,objects:r}=H(Ie),i=T(e,"x"),s=T(e,"y"),h=T(e,"page"),p=T(e,"width"),g=T(e,"height"),{id:P,x:c,y:u,page:f,width:y,height:b,minHeight:D,minWidth:F,maxHeight:W,maxWidth:Y,ratio:V}=_e(e),$=E(!1),K=E(),X=E(),k=E(),x=we(f),ne=Pe(t,{onstart(){const{left:l,top:d}=t.value.getBoundingClientRect();$.value=!0,K.value=c.value,X.value=u.value,k.value=f.value,c.value=l,u.value=d},onmove(l){c.value+=l.dx,u.value+=l.dy},onend(l){if(l.relatedTarget){const d=Be({reference:l.relatedTarget,container:n.value,object:t.value,scale:a.value});c.value=d.x,u.value=d.y,f.value=d.page}else c.value=K.value,u.value=X.value,f.value=k.value;$.value=!1}}),L=Oe(t,{minHeight:D,minWidth:F,maxHeight:W,maxWidth:Y,scale:a,ratio:V,reference:x,onmove(l){l.rect&&a.value&&(y.value=l.rect.width/a.value,b.value=l.rect.height/a.value)}});Q(l=>{if(t.value)if(x.value&&n.value)if(t.value.style.display="block",t.value.style.width=`${y.value}px`,t.value.style.height=`${b.value}px`,$.value)t.value.style.position="fixed",t.value.style.transform=`translate(${c.value}px, ${u.value}px) scale(${a.value})`,t.value.style.zIndex="50";else{const d=te(x.value,t.value,()=>{const{left:m,top:N}=ze({reference:x.value,container:n.value,x:c.value,y:u.value,scale:a.value});t.value.style.position="absolute",t.value.style.transform=`translate(${m}px, ${N}px) scale(${a.value})`,t.value.style.zIndex="10"},{ancestorScroll:!1,animationFrame:!0});l(d)}else t.value.style.display="none"});function z(l,d,m){if(e.moveable){const N=x.value.clientWidth,I=x.value.clientHeight,A=Math.floor(N/a.value-y.value),J=Math.floor(I/a.value-b.value),ie=l.metaKey||l.ctrlKey?A:l.shiftKey?10:1,se=l.metaKey||l.ctrlKey?J:l.shiftKey?10:1,le=c.value+d*ie,re=u.value+m*se;c.value=M(le,0,A),u.value=M(re,0,J)}}function oe(){const l=[...r.values()].filter(I=>I.id!==P&&Number.isFinite(I.x)&&Number.isFinite(I.y)&&I.page===f.value),d={width:y.value,height:b.value},m={width:x.value.clientWidth/a.value,height:x.value.clientHeight/a.value},N=Me({size:d,offside:m,objects:l});c.value=N.x,u.value=N.y}return _(c,i),_(u,s),_(f,h),_(y,p),_(b,g),_(ne,Z(e,"moveable"),{direction:"rtl",immediate:!0}),_(L,Z(e,"resizable"),{direction:"rtl",immediate:!0}),ue(async()=>{await ce(x).toBeTruthy(),(!Number.isFinite(c.value)||!Number.isFinite(u.value))&&oe(),e.autofocus&&Ne(t.value)}),de(ae,{id:P,x:c,y:u,page:f,width:y,height:b,minHeight:D,minWidth:F,maxHeight:W,maxWidth:Y,ratio:V}),(l,d)=>(C(),ee("div",{ref_key:"object",ref:t,"data-testid":"pdf-object",class:"pdf-object",tabindex:"0","data-x":v(c),"data-y":v(u),"data-page":v(f),"data-width":v(y),"data-height":v(b),onKeydown:[d[0]||(d[0]=B(R(m=>z(m,0,-1),["stop","prevent"]),["up"])),d[1]||(d[1]=B(R(m=>z(m,0,1),["stop","prevent"]),["down"])),d[2]||(d[2]=B(R(m=>z(m,-1,0),["stop","prevent"]),["left"])),d[3]||(d[3]=B(R(m=>z(m,1,0),["stop","prevent"]),["right"]))]},[w("div",Ve,[fe(l.$slots,"default"),o.debug?(C(),ve(We,{key:0})):he("",!0)]),pe(w("div",Ke,null,512),[[me,v(L)]])],40,Ye))}});export{Ze as _,Be as g};

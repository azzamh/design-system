import{H as S,O as D,z as j,ai as U,Y as Z,q as v,d as G,r as E,A as Q,o as C,c as ee,p as w,t as O,a9 as q,m as ue,$ as ce,a as de,f as fe,g as ve,a8 as he,ac as pe,a0 as B,a2 as R}from"./framework.9r1f5sdm.js";import{a as te,c as me,b as ge,o as ye}from"./floating-ui.dom.Gn4DI--7.js";import{h as T}from"./index.uolO-Csu.js";import{D as be,P as ae,u as xe,a as _e,f as we,b as Ne}from"./PdfViewer.vue_vue_type_style_index_0_lang.ERmzb5jo.js";import{c as $}from"./use-focus.oPJP1ZqW.js";import{m as Ie}from"./memoize.UOSzi-11.js";import{s as _,u as Ee}from"./index.rL4v00xu.js";function Pe(i,e){const t=S(!0),o=S(),{hoverzone:a}=D(be);async function r(){if(n(),i.value){const{default:s}=await Z(()=>import("./interact.min.sqNF6zsx.js").then(h=>h.i),__vite__mapDeps([0,1,2]));o.value=s(i.value).draggable({inertia:!0,enabled:t.value,autoScroll:{container:i.value.parentElement,margin:100,speed:300},onstart:e.onstart,onmove:e.onmove,onend:e.onend,modifiers:[s.modifiers.restrict({restriction:"parent",elementRect:{top:0,left:0,bottom:1,right:1}}),s.modifiers.restrictRect({endOnly:!0,restriction:()=>a.value?s.getElementRect(a.value):{top:0,left:0,bottom:Number.POSITIVE_INFINITY,right:Number.POSITIVE_INFINITY}})]}).on("tap",e.ontap)}}function n(){o.value&&o.value.unset()}return j(i,async()=>{await r()}),j(t,s=>{o.value&&o.value.draggable(s)}),U(()=>{n()}),t}function Oe(i,e={}){const t=S(!0),o=S();async function a(){var n,s,h;if(r(),i.value){const{default:p}=await Z(()=>import("./interact.min.sqNF6zsx.js").then(g=>g.i),__vite__mapDeps([0,1,2]));o.value=p(i.value).resizable({enabled:t.value,edges:{left:!1,top:!1,bottom:(n=e.handleSelector)!=null?n:".resize-handle",right:(s=e.handleSelector)!=null?s:".resize-handle"},onstart:e.onstart,onmove:e.onmove,onend:e.onend,modifiers:[p.modifiers.aspectRatio({ratio:(h=v(e.ratio))!=null?h:"preserve",modifiers:[p.modifiers.restrictSize({min:(g,P,c)=>{var f;const u=(f=v(e.scale))!=null?f:1;return{...c.rect,width:v(e.minWidth)*u,height:v(e.minHeight)*u}},max:(g,P,c)=>{var f;const u=(f=v(e.scale))!=null?f:1;return{...c.rect,width:v(e.maxWidth)*u,height:v(e.maxHeight)*u}}}),p.modifiers.restrictSize({max:(g,P,c)=>{const u=v(e.reference);if(u){const f=p.getElementRect(u);if(f){const y=f.right-c.rect.left,b=f.bottom-c.rect.top;return{...f,width:y,height:b}}}return{...c.rect,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY}}})]})]})}}function r(){o.value&&o.value.unset()}return j(i,async()=>{await a()}),j(t,n=>{o.value&&o.value.draggable(n)},{immediate:!0}),U(()=>{r()}),t}function Te(i,e=document.body){let t=i.parentElement;do{const{position:o}=window.getComputedStyle(t);if(o==="relative"||o==="absolute")return t;t=t.parentElement}while(t&&t!==e);return e}function ze(i){const{container:e,reference:t,x:o,y:a,scale:r}=i,n=t.getBoundingClientRect(),s=Te(t,e),h=s.getBoundingClientRect(),p=n.top-h.top+s.scrollTop,g=n.left-h.left+s.scrollLeft;return{top:p+a*r,left:g+o*r}}function Be(i){const{reference:e,object:t,scale:o}=i,a=t.getBoundingClientRect(),r=e.getBoundingClientRect(),n=Math.floor((r.width-a.width)/o),s=Math.floor((r.height-a.height)/o),h=(a.left-r.left)/o,p=(a.top-r.top)/o,g=Number.parseInt(e.dataset.pageNumber);return{x:$(h,1,n-1),y:$(p,1,s-1),page:g}}function Re(i,e){return{x:(e.width-i.width)/2,y:(e.height-i.height)/2}}function Se(i,e){return i.x+i.width>e.width||i.y+i.height>e.height}function je(i){var o;const e=new Map,t=Ie(a=>Math.round(a/15)*15);for(const a of i){const r=t(a.x),n=t(a.y),s=(o=e.get(r))!=null?o:new Map;s.set(n,a),e.set(r,s)}return a=>{var s;const r=t(a.x),n=t(a.y);return((s=e.get(r))==null?void 0:s.get(n))!==void 0}}function $e(i){var s;const e=(s=i.checkOverlap)!=null?s:je(i.objects),t=Re(i.size,i.offside),o={...i.size,...t};let a=!0,r=0,n=0;do a=!0,Se(o,i.offside)&&(o.y=t.y+n,o.x=t.x,n+=15,a=!1),e(o,i.objects)&&(o.x+=15,o.y+=15,a=!1);while(!a&&++r<=500);return a||console.warn("Cannot find empty position, max iteration reach"),o}const Me={"data-testid":"debug-x"},Ce={"data-testid":"debug-y"},De={"data-testid":"debug-page"},Fe={"data-testid":"debug-width"},He={"data-testid":"debug-height"},Ye=G({__name:"PdfObjectDebugger",setup(i){const{x:e,y:t,page:o,width:a,height:r}=D(ae),n=E();return Q(s=>{if(n.value){const h=te(n.value.parentElement,n.value,()=>{me(n.value.parentElement,n.value,{strategy:"absolute",middleware:[ge(),ye(12)]}).then(({x:p,y:g})=>{n.value&&(n.value.style.left=`${p||0}px`,n.value.style.top=`${g||0}px`)})},{animationFrame:!0});s(h)}},{flush:"post"}),(s,h)=>(C(),ee("div",{ref_key:"target",ref:n,"data-testid":"pdf-debugger",class:"pdf-object__debugger"},[w("pre",Me,"x: "+O(v(e)),1),w("pre",Ce,"y: "+O(v(t)),1),w("pre",De,"page: "+O(v(o)),1),w("pre",Fe,"width: "+O(v(a)),1),w("pre",He,"height: "+O(v(r)),1)],512))}}),We=["data-x","data-y","data-page","data-width","data-height"],Ve={class:"pdf-object__container"},Ke={class:"pdf-object__resize resize-handle"},Ze=G({__name:"PdfObject",props:{x:{type:Number,default:void 0},y:{type:Number,default:void 0},page:{type:Number,default:void 0},width:{type:Number,default:198},height:{type:Number,default:106},minWidth:{type:Number,default:void 0},minHeight:{type:Number,default:void 0},maxWidth:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},moveable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!1},debug:{type:Boolean,default:!1}},emits:["update:x","update:y","update:page","update:width","update:height"],setup(i){const e=i,t=E(),{root:o,scale:a,objects:r}=D(Ne),n=T(e,"x"),s=T(e,"y"),h=T(e,"page"),p=T(e,"width"),g=T(e,"height"),{id:P,x:c,y:u,page:f,width:y,height:b,minHeight:F,minWidth:H,maxHeight:Y,maxWidth:W,ratio:V}=xe(e),M=E(!1),K=E(),X=E(),k=E(),x=_e(f),oe=Pe(t,{onstart(){const{left:l,top:d}=t.value.getBoundingClientRect();M.value=!0,K.value=c.value,X.value=u.value,k.value=f.value,c.value=l,u.value=d},onmove(l){c.value+=l.dx,u.value+=l.dy},onend(l){if(l.relatedTarget){const d=Be({reference:l.relatedTarget,container:o.value,object:t.value,scale:a.value});c.value=d.x,u.value=d.y,f.value=d.page}else c.value=K.value,u.value=X.value,f.value=k.value;M.value=!1}}),L=Oe(t,{minHeight:F,minWidth:H,maxHeight:Y,maxWidth:W,scale:a,ratio:V,reference:x,onmove(l){l.rect&&a.value&&(y.value=l.rect.width/a.value,b.value=l.rect.height/a.value)}});Q(l=>{if(t.value)if(x.value&&o.value)if(t.value.style.display="block",t.value.style.width=`${y.value}px`,t.value.style.height=`${b.value}px`,M.value)t.value.style.position="fixed",t.value.style.transform=`translate(${c.value}px, ${u.value}px) scale(${a.value})`,t.value.style.zIndex="50";else{const d=te(x.value,t.value,()=>{const{left:m,top:N}=ze({reference:x.value,container:o.value,x:c.value,y:u.value,scale:a.value});t.value.style.position="absolute",t.value.style.transform=`translate(${m}px, ${N}px) scale(${a.value})`,t.value.style.zIndex="10"},{ancestorScroll:!1,animationFrame:!0});l(d)}else t.value.style.display="none"});function z(l,d,m){if(e.moveable){const N=x.value.clientWidth,I=x.value.clientHeight,A=Math.floor(N/a.value-y.value),J=Math.floor(I/a.value-b.value),ne=l.metaKey||l.ctrlKey?A:l.shiftKey?10:1,se=l.metaKey||l.ctrlKey?J:l.shiftKey?10:1,le=c.value+d*ne,re=u.value+m*se;c.value=$(le,0,A),u.value=$(re,0,J)}}function ie(){const l=[...r.values()].filter(I=>I.id!==P&&Number.isFinite(I.x)&&Number.isFinite(I.y)&&I.page===f.value),d={width:y.value,height:b.value},m={width:x.value.clientWidth/a.value,height:x.value.clientHeight/a.value},N=$e({size:d,offside:m,objects:l});c.value=N.x,u.value=N.y}return _(c,n),_(u,s),_(f,h),_(y,p),_(b,g),_(oe,q(e,"moveable"),{direction:"rtl",immediate:!0}),_(L,q(e,"resizable"),{direction:"rtl",immediate:!0}),ue(async()=>{await Ee(x).toBeTruthy(),(!Number.isFinite(c.value)||!Number.isFinite(u.value))&&ie(),e.autofocus&&we(t.value)}),ce(ae,{id:P,x:c,y:u,page:f,width:y,height:b,minHeight:F,minWidth:H,maxHeight:Y,maxWidth:W,ratio:V}),(l,d)=>(C(),ee("div",{ref_key:"object",ref:t,"data-testid":"pdf-object",class:"pdf-object",tabindex:"0","data-x":v(c),"data-y":v(u),"data-page":v(f),"data-width":v(y),"data-height":v(b),onKeydown:[d[0]||(d[0]=B(R(m=>z(m,0,-1),["stop","prevent"]),["up"])),d[1]||(d[1]=B(R(m=>z(m,0,1),["stop","prevent"]),["down"])),d[2]||(d[2]=B(R(m=>z(m,-1,0),["stop","prevent"]),["left"])),d[3]||(d[3]=B(R(m=>z(m,1,0),["stop","prevent"]),["right"]))]},[w("div",Ve,[de(l.$slots,"default"),i.debug?(C(),fe(Ye,{key:0})):ve("",!0)]),he(w("div",Ke,null,512),[[pe,v(L)]])],40,We))}});export{Ze as _,Be as g};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/chunks/interact.min.sqNF6zsx.js","assets/chunks/theme.bACF73O4.js","assets/chunks/framework.9r1f5sdm.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
